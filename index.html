<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrap Master Pro - Jan 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background: #020617; color: #f8fafc; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(30, 41, 59, 0.5); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.05); }
        .tab-active { border-bottom: 3px solid #3b82f6; color: #3b82f6; }
        .status-dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; }
    </script>
</head>
<body class="p-2 sm:p-4">

    <nav class="flex justify-around mb-6 border-b border-slate-800 bg-slate-900/50 rounded-t-2xl">
        <button onclick="showTab('calc')" id="tab-calc" class="p-4 flex-1 font-bold tab-active"><i class="fas fa-calculator mr-2"></i>Calc</button>
        <button onclick="showTab('settings')" id="tab-settings" class="p-4 flex-1 font-bold text-slate-400"><i class="fas fa-cog mr-2"></i>Settings</button>
    </nav>

    <div id="view-calc" class="tab-view">
        <div class="glass p-3 rounded-xl mb-4 flex justify-between items-center text-xs">
            <span class="text-slate-400">USD/ZAR Rate: <strong id="fx-rate">R 16.11</strong></span>
            <span class="text-slate-400">Market: <strong class="text-green-400">Bullish</strong></span>
        </div>

        <div class="glass p-5 rounded-3xl shadow-xl">
            <div class="grid grid-cols-2 gap-3 mb-4">
                <div>
                    <label class="text-xs text-slate-400 ml-1">Metal</label>
                    <select id="metalType" onchange="updateGrades()" class="w-full bg-slate-800 rounded-xl p-3 text-sm border-none outline-none">
                        <option value="copper">Copper</option>
                        <option value="brass">Brass</option>
                        <option value="aluminium">Aluminium</option>
                        <option value="stainless">Stainless</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs text-slate-400 ml-1">Grade</label>
                    <select id="metalGrade" class="w-full bg-slate-800 rounded-xl p-3 text-sm border-none outline-none"></select>
                </div>
            </div>

            <div class="mb-6">
                <label class="text-xs text-slate-400 ml-1">Weight (kg)</label>
                <input type="number" id="weight" placeholder="0.00" oninput="calculate()" class="w-full bg-slate-800 p-4 rounded-xl text-3xl font-black text-blue-400 outline-none">
            </div>

            <div id="results" class="bg-blue-600/10 border border-blue-500/20 p-6 rounded-2xl text-center mb-4">
                <p class="text-xs text-blue-400 font-bold uppercase tracking-wider">Estimated Payout</p>
                <div class="text-4xl font-black my-1">R <span id="zar-total">0.00</span></div>
                <div class="text-lg text-slate-400">$ <span id="usd-total">0.00</span></div>
            </div>
            
            <button onclick="saveDeal()" class="w-full bg-blue-600 p-4 rounded-xl font-bold active:scale-95 transition-transform">
                Save Logged Deal
            </button>
        </div>
    </div>

    <div id="view-settings" class="tab-view hidden">
        <div class="glass p-5 rounded-3xl">
            <h2 class="text-lg font-bold mb-4">API Configuration</h2>
            
            <div class="mb-4">
                <label class="text-xs text-slate-400 ml-1">Gemini API Key</label>
                <input type="password" id="apiKeyInput" placeholder="Enter key here..." class="w-full bg-slate-800 p-3 rounded-xl text-sm border-none mb-2">
                <button onclick="saveKey()" class="text-xs bg-slate-700 px-4 py-2 rounded-lg">Save to Device</button>
            </div>

            <div class="p-4 bg-slate-900 rounded-2xl border border-slate-700">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-sm font-bold">API Status</span>
                    <span id="conn-status" class="text-xs text-slate-500">Not Tested</span>
                </div>
                <div id="test-result" class="text-[10px] font-mono text-slate-400 mb-3 break-all bg-black/30 p-2 rounded">
                    Ready to test Gemini 3 Flash...
                </div>
                <button onclick="testConnection()" id="btn-test" class="w-full bg-green-600/20 border border-green-500/50 text-green-400 p-2 rounded-lg text-xs font-bold hover:bg-green-600/30">
                    <i class="fas fa-bolt mr-1"></i> TEST GEMINI 3 FLASH
                </button>
            </div>
        </div>
    </div>

    <script>
        // Jan 2026 Scrap Rates & FX
        const USD_ZAR = 16.11; 
        const rates = {
            copper: { "Bright/Shiny": 172.50, "Candy (Cu1)": 157.50, "Mixed/Burnt": 145.00 },
            brass: { "Heavy/Honey": 92.50, "Mixed/Taps": 82.50 },
            aluminium: { "6061 Extrusion": 26.00, "Clean Wire": 35.00, "Cans/UBC": 20.00 },
            stainless: { "316 Solids": 25.00, "304 Solids": 15.00 }
        };

        function showTab(tab) {
            document.querySelectorAll('.tab-view').forEach(v => v.classList.add('hidden'));
            document.getElementById(`view-${tab}`).classList.remove('hidden');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('tab-active', 'text-slate-400'));
            document.getElementById(`tab-${tab}`).classList.add('tab-active');
        }

        function updateGrades() {
            const metal = document.getElementById('metalType').value;
            const gradeSelect = document.getElementById('metalGrade');
            gradeSelect.innerHTML = '';
            Object.entries(rates[metal]).forEach(([name, price]) => {
                let opt = new Option(name, price);
                gradeSelect.add(opt);
            });
            calculate();
        }

        function calculate() {
            const w = document.getElementById('weight').value || 0;
            const r = document.getElementById('metalGrade').value;
            const totalZAR = w * r;
            const totalUSD = totalZAR / USD_ZAR;
            
            document.getElementById('zar-total').innerText = totalZAR.toLocaleString('en-ZA', {minimumFractionDigits: 2});
            document.getElementById('usd-total').innerText = totalUSD.toLocaleString('en-US', {minimumFractionDigits: 2});
        }

        function saveKey() {
            const key = document.getElementById('apiKeyInput').value;
            localStorage.setItem('GEMINI_API_KEY', key);
            alert("Key Saved Offline!");
        }

        async function testConnection() {
            const key = localStorage.getItem('GEMINI_API_KEY');
            const statusBox = document.getElementById('test-result');
            const statusText = document.getElementById('conn-status');
            
            if (!key) { statusBox.innerText = "Error: No API Key found in settings."; return; }

            statusBox.innerText = "Pinging Gemini 3 Flash...";
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash:generateContent?key=${key}`;
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: "Respond with only 'Active: Gemini 3 Flash is Live'" }] }] })
                });
                const data = await response.json();
                
                if (data.candidates) {
                    statusBox.innerText = data.candidates[0].content.parts[0].text;
                    statusText.innerText = "CONNECTED";
                    statusText.className = "text-xs text-green-400 font-bold";
                } else {
                    statusBox.innerText = "API Error: " + JSON.stringify(data.error);
                }
            } catch (e) {
                statusBox.innerText = "Connection Failed: Check internet or key.";
            }
        }

        // Init
        document.getElementById('apiKeyInput').value = localStorage.getItem('GEMINI_API_KEY') || "";
        updateGrades();
    </script>
</body>
</html>
